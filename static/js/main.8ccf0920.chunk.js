(this.webpackJsonpplack=this.webpackJsonpplack||[]).push([[0],{130:function(e,a,t){},275:function(e,a,t){e.exports=t(452)},451:function(e,a,t){},452:function(e,a,t){"use strict";t.r(a);var n=t(0),l=t.n(n),r=t(50),c=t.n(r),s=t(71),o=t(43),i=t(18),u={user:null,isLoading:!0},d={channel:null},m=Object(s.c)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"SET_USER":return Object(i.a)({},e,{user:a.user,isLoading:!1});default:return e}},channel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"SET_CHANNEL":return Object(i.a)({},e,{channel:a.channel});default:return e}}}),h=t(233),f=t(234),p=t.n(f),g=t(70),E=t(39),b=t(40),v=t(41),C=t(42),j=t(44),O=t(62),y=t(161),k=t.n(y);t(284),t(286),t(453);k.a.initializeApp({apiKey:"AIzaSyBa643TjTtPD0rnjdOfuFLpYyzDdsqr0Iw",authDomain:"plack-23141.firebaseapp.com",databaseURL:"https://plack-23141.firebaseio.com",projectId:"plack-23141",storageBucket:"plack-23141.appspot.com",messagingSenderId:"360318459062",appId:"1:360318459062:web:a7d366336084667dacda17",measurementId:"G-E16F9YZVBR"});var S=k.a,w=t(20),N=t(59),R=t(235),A=t.n(R),L=t(474),M=t(463),P=t(481),T=t(72),D=t(470),F=t(478),U=t(454),x=(t(130),function(){var e=Object(n.useState)({username:"",email:"",password:"",passwordConfirm:"",errors:"",loading:!1,usersRef:S.database().ref("users")}),a=Object(N.a)(e,2),t=a[0],r=a[1],c=function(e){r(Object(i.a)({},t,Object(w.a)({},e.target.name,e.target.value)))},s=function(e){var a=e.username,t=e.password,n=e.email;return a.length&&t.length&&n.length>0},o=function(e){var a=e.password;return a===e.passwordConfirm&&a.length>=6},u=function(e){return t.usersRef.child(e.user.uid).set({name:e.user.displayName,avatar:e.user.photoURL})},d=l.a.createElement(L.a,{color:"red"},t.errors);return l.a.createElement(M.a,{className:"u-heigth100vh",textAlign:"center",verticalAlign:"middle"},l.a.createElement(M.a.Column,{style:{maxWidth:450}},l.a.createElement(P.a,{as:"h2",color:"red",textAlign:"center"},l.a.createElement(T.a,{name:"code",color:"black"}),"Register for Plack"),l.a.createElement(D.a,{size:"large"},l.a.createElement(F.a,{stacked:!0},l.a.createElement(D.a.Input,{fluid:!0,name:"username",icon:"user",iconPosition:"left",placeholder:"Username",onChange:c,type:"text"}),l.a.createElement(D.a.Input,{fluid:!0,name:"email",icon:"mail",iconPosition:"left",placeholder:"Email-adress",onChange:c,type:"email"}),l.a.createElement(D.a.Input,{fluid:!0,name:"password",icon:"lock",iconPosition:"left",placeholder:"Password",onChange:c,type:"password"}),l.a.createElement(D.a.Input,{fluid:!0,name:"passwordConfirm",icon:"repeat",iconPosition:"left",placeholder:"Repeat password",onChange:c,type:"password"}),l.a.createElement(U.a,{disabled:t.loading,className:t.loading?"loading":null,onClick:function(e){(s(t)?o(t)||(r(Object(i.a)({},t,{errors:"Passwords do not match or password to short"})),0):(r(Object(i.a)({},t,{errors:"Fill all fields"})),0))&&(e.preventDefault(),r(Object(i.a)({},t,{loading:!0,errors:""})),S.auth().createUserWithEmailAndPassword(t.email,t.password).then((function(e){e.user.updateProfile({displayName:t.username,photoURL:"https://www.gravatar.com/avatar/".concat(A()(e.user.email),"?d=identicon")}).then((function(){u(e)})).catch((function(e){console.log(e),r(Object(i.a)({},t,{loading:!1,errors:e.message}))}))})).catch((function(e){r(Object(i.a)({},t,{loading:!1,errors:e.message})),console.log(e)})))},color:"red",fluid:!0,size:"large"},"Submit"))),t.errors.length>0?d:null,l.a.createElement(L.a,null,"Already a user? ",l.a.createElement(g.b,{to:"/login"},"Login"))))}),I=function(){var e=Object(n.useState)({email:null,password:null,errors:"",loading:!1}),a=Object(N.a)(e,2),t=a[0],r=a[1],c=function(e){r(Object(i.a)({},t,Object(w.a)({},e.target.name,e.target.value)))},s=function(e){var a=e.email,t=e.password;return!(!a||!t)||r((function(e){return Object(i.a)({},e,{errors:"Fill all fields"})}))},o=l.a.createElement(L.a,{color:"red"},t.errors);return l.a.createElement(M.a,{className:"u-heigth100vh",textAlign:"center",verticalAlign:"middle"},l.a.createElement(M.a.Column,{style:{maxWidth:450}},l.a.createElement(P.a,{as:"h2",color:"red",textAlign:"center"},l.a.createElement(T.a,{name:"code",color:"black"}),"Login to Plack"),l.a.createElement(D.a,{size:"large"},l.a.createElement(F.a,{stacked:!0},l.a.createElement(D.a.Input,{fluid:!0,name:"email",icon:"mail",iconPosition:"left",placeholder:"Email-adress",onChange:c,type:"email"}),l.a.createElement(D.a.Input,{fluid:!0,name:"password",icon:"lock",iconPosition:"left",placeholder:"Password",onChange:c,type:"password"}),l.a.createElement(U.a,{disabled:t.loading,className:t.loading?"loading":null,onClick:function(e){s(t)&&(e.preventDefault(),r((function(e){return Object(i.a)({},e,{loading:!0,errors:""})})),S.auth().signInWithEmailAndPassword(t.email,t.password).then((function(e){r((function(e){return Object(i.a)({},e,{loading:!1})}))})).catch((function(e){console.log(e),r((function(a){return Object(i.a)({},a,{loading:!1,errors:e.message})}))})))},color:"red",fluid:!0,size:"large"},"Login"))),t.errors.length>0?o:null,l.a.createElement(L.a,null,"Not a user? ",l.a.createElement(g.b,{to:"/register"},"Register"))))},z=t(238),_=t(477),B=t(475),W=t(467),G=function(){return l.a.createElement(_.a,{as:B.a,icon:"labeled",inverted:!0,vertical:!0,visible:!0,width:"very thin"},l.a.createElement(W.a,null),l.a.createElement(U.a,{icon:"add",size:"small",color:"blue"}))},H=t(239),V=t(163),J=t(473),q=t(263),K=function(e){var a=e.userData,t=Object(o.c)(),n=[{key:"user",text:l.a.createElement("span",null,"Signed in as ",l.a.createElement("strong",null,a.displayName)),disabled:!0},{key:"avatar",text:l.a.createElement("span",null,"Change Avatar")},{key:"signout",text:l.a.createElement("span",{onClick:function(){S.auth().signOut(),t({type:"RESET_APP"})}},"Sign Out")}];return l.a.createElement(M.a,null,l.a.createElement(z.a,null,l.a.createElement(H.a,{style:{padding:"1.2em",margin:0}},l.a.createElement(P.a,{inverted:!0,floated:"left",as:"h2"},l.a.createElement(T.a,{name:"code"}),l.a.createElement(V.a,null,"Plack")),l.a.createElement(P.a,{style:{padding:"0.25em"},as:"h4",inverted:!0},l.a.createElement(J.a,{trigger:l.a.createElement("span",null,l.a.createElement(q.a,{src:a.photoURL,spaced:"right",avatar:!0}),a.displayName),options:n})))))},Y=t(471),Z=t(464),Q=function(e){function a(){var e,t;Object(E.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(t=Object(v.a)(this,(e=Object(C.a)(a)).call.apply(e,[this].concat(r)))).state={modal:!1,channelName:"",channelDetails:"",channels:[],channelsRef:S.database().ref("channels"),firstLoad:!0,activeChannel:null},t.addListeners=function(){var e=[];t.state.channelsRef.on("child_added",(function(a){e.push(a.val()),t.setState({channels:e},(function(){return t.setFirstChannel()}))}))},t.setFirstChannel=function(){t.state.firstLoad&&(t.props.setChannel(t.state.channels[0]),t.setState({firstLoad:!1,activeChannel:t.state.channels[0].id}))},t.closeModal=function(){return t.setState({modal:!1})},t.openModal=function(){return t.setState({modal:!0})},t.handleChange=function(e){t.setState(Object(w.a)({},e.target.name,e.target.value))},t.handleSubmit=function(e){e.preventDefault(),t.isFormValid(t.state)&&t.addChannel()},t.addChannel=function(){var e=t.state.channelsRef.push().key,a=t.props.userData,n=t.state,l={id:e,name:n.channelName,details:n.channelDetails,createdBy:{name:a.displayName,avatar:a.photoURL}};t.state.channelsRef.child(e).update(l).then((function(){t.setState({channelName:"",channelDetails:""}),t.closeModal()})).catch((function(e){console.log(e)}))},t.isFormValid=function(e){var a=e.channelName,t=e.channelDetails;return a&&t},t.changeChannel=function(e){t.props.setChannel(e),t.setState({activeChannel:e.id})},t.displayChannels=function(e){return e.map((function(e){return l.a.createElement(B.a.Item,{key:e.id,onClick:function(){return t.changeChannel(e)},name:e.name,active:t.state.activeChannel===e.id},"#",e.name)}))},t}return Object(j.a)(a,e),Object(b.a)(a,[{key:"componentDidMount",value:function(){this.addListeners()}},{key:"componentWillUnmount",value:function(){console.log("Unmount"),this.state.channelsRef.off()}},{key:"render",value:function(){return l.a.createElement(l.a.Fragment,null,l.a.createElement(B.a.Menu,{style:{paddingBottom:"2em"}},l.a.createElement(B.a.Item,null,l.a.createElement("span",null,l.a.createElement(T.a,{name:"exchange"})," CHANNELS"),"(",this.state.channels.length,")"," ",l.a.createElement(T.a,{name:"add",onClick:this.openModal})),this.displayChannels(this.state.channels)),l.a.createElement(Y.a,{basic:!0,open:this.state.modal,onClose:this.closeModal},l.a.createElement(Y.a.Header,null,"Add a Channel"),l.a.createElement(Y.a.Content,null,l.a.createElement(D.a.Field,{onSubmit:this.handleSubmit},l.a.createElement(D.a.Field,null,l.a.createElement(Z.a,{fluid:!0,label:"Name of channel",name:"channelName",onChange:this.handleChange})),l.a.createElement(D.a.Field,null,l.a.createElement(Z.a,{fluid:!0,label:"About the Channel",name:"channelDetails",onChange:this.handleChange})))),l.a.createElement(Y.a.Actions,null,l.a.createElement(U.a,{color:"green",inverted:!0,onClick:this.handleSubmit},l.a.createElement(T.a,{name:"checkmark"})," Add"),l.a.createElement(U.a,{color:"red",inverted:!0,onClick:this.closeModal},l.a.createElement(T.a,{name:"remove"})," Cancel"))))}}]),a}(l.a.Component),X=Object(o.b)(null,{setChannel:function(e){return{type:"SET_CHANNEL",channel:e}}})(Q),$=function(e){var a=e.userData;return l.a.createElement(B.a,{style:{backgroundColor:"#40123e"},fixed:"left",vertical:!0,inverted:!0,size:"large"},l.a.createElement(K,{userData:a}),l.a.createElement(X,{userData:a}))},ee=t(472),ae=function(e){var a=e.channelName,t=e.userAmount,n=e.handleChange;return l.a.createElement(F.a,{clearing:!0},l.a.createElement(P.a,{fluid:"true",as:"h2",floated:"left"},l.a.createElement("span",null,a,l.a.createElement(T.a,{name:"star outline",color:"black"})),l.a.createElement(P.a.Subheader,null,t)),l.a.createElement(P.a,{floated:"right"},l.a.createElement(Z.a,{size:"mini",type:"text",icon:"search",name:"searchTerm",placeholder:"Search Messages",onChange:n})))},te=t(476),ne=t(167),le=t.n(ne),re=function(e){var a=e.modal,t=e.closeModal,r=e.uploadFile,c=Object(n.useState)({file:null,authorized:["image/jpeg","image/png"]}),s=Object(N.a)(c,2),o=s[0],u=s[1],d=function(){u(Object(i.a)({},o,{file:null}))},m=function(e){return o.authorized.includes(le.a.lookup(e))};return l.a.createElement(Y.a,{basic:!0,open:a,onClose:t},l.a.createElement(Y.a.Header,null,"Select an image file"),l.a.createElement(Y.a.Content,null,l.a.createElement(Z.a,{onChange:function(e){var a=e.target.files[0];a&&u(Object(i.a)({},o,{file:a}))},fluid:!0,label:"File types: JPEG, PNG",name:"file",type:"file"})),l.a.createElement(Y.a.Actions,null,l.a.createElement(U.a,{color:"green",onClick:function(){if(null!==o.file&&m(o.file.name)){var e={contentType:le.a.lookup(o.file.name)};r(o.file,e),d(),t()}},inverted:!0},l.a.createElement(T.a,{name:"checkmark"})," Send"),l.a.createElement(U.a,{color:"red",inverted:!0,onClick:function(){t(),d()}},l.a.createElement(T.a,{name:"remove"})," Cancel")))},ce=t(468),se=function(e){var a=e.uploadState,t=e.percents;return"uploading"===a&&l.a.createElement(ce.a,{className:"progress_bar",percent:t,progress:!0,indicating:!0,size:"medium",inverted:!0})},oe=function(e){function a(){var e;return Object(E.a)(this,a),(e=Object(v.a)(this,Object(C.a)(a).call(this))).handleChange=function(a){e.setState(Object(w.a)({},a.target.name,a.target.value))},e.createMessage=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t={timestamp:S.database.ServerValue.TIMESTAMP,user:{id:e.props.user.uid,name:e.props.user.displayName,avatar:e.props.user.photoURL}};return null!==a?t.image=a:t.content=e.state.message,t},e.uploadFile=function(a,t){var n="chat/public/".concat(Object(te.a)(),".jpg"),l=e.props.channel.id,r=e.props.messageRef;e.setState({uploadState:"uploading",uploadTask:e.state.storageRef.child(n).put(a,t)},(function(){e.state.uploadTask.on("state_changed",(function(a){var t=Math.round(a.bytesTransferred/a.totalBytes*100);e.setState({percentUploaded:t})}),(function(a){console.log(a),e.setState({uploadState:"error",uploadTask:null})}),(function(){e.state.uploadTask.snapshot.ref.getDownloadURL().then((function(a){e.sendFileMessage(a,r,l)})).catch((function(a){console.log(a),e.setState({uploadState:"error",uploadTask:null})}))}))}))},e.sendFileMessage=function(a,t,n){t.child(n).push().set(e.createMessage(a)).then((function(){e.setState({uploadState:"done"})})).catch((function(a){console.log(a),e.setState({error:a.message})}))},e.sendMessage=function(){var a=e.props,t=a.messageRef,n=a.channel;e.state.message.length>0?(e.setState({loading:!0,error:""}),t.child(n.id).push().set(e.createMessage()).then((function(){e.setState({loading:!1,message:""})})).catch((function(a){console.log(a),e.setState({loading:!1,message:"",error:a.message})}))):e.setState({error:"No data filled"})},e.openModal=function(){return e.setState({modal:!0})},e.closeModal=function(){return e.setState({modal:!1})},e.state={message:"",loading:!1,error:"",modal:!1,uploadTask:null,uploadState:"",percentUploaded:0,storageRef:S.storage().ref()},e}return Object(j.a)(a,e),Object(b.a)(a,[{key:"render",value:function(){var e=this,a=this.state,t=a.message,n=a.error,r=a.loading,c=a.modal,s=a.uploadState,o=a.percentUploaded;return l.a.createElement(F.a,{className:"messageForm"},l.a.createElement(Z.a,{value:t,fluid:!0,name:"message",label:l.a.createElement(U.a,{icon:"add"}),labelPosition:"left",className:n.length>0?"error":null,placeholder:"Write your message",onChange:this.handleChange,onKeyDown:function(a){return 13===a.keyCode?e.sendMessage():null}}),l.a.createElement(U.a.Group,{icon:!0,widths:"2",style:{marginTop:"10px"}},l.a.createElement(U.a,{color:"green",content:"Add Reply",labelPosition:"left",icon:"edit",onClick:this.sendMessage,disabled:r,className:r?"loading":null}),l.a.createElement(U.a,{color:"red",content:"Upload Media",disabled:"uploading"===s,labelPosition:"right",icon:"cloud upload",onClick:this.openModal})),l.a.createElement(re,{modal:c,closeModal:this.closeModal,uploadFile:this.uploadFile}),l.a.createElement(se,{uploadState:s,percents:o}))}}]),a}(l.a.Component),ie=t(262),ue=t.n(ie),de=function(e,a){return e.user.id===a.uid?"message_self":null},me=function(e){var a,t=e.message,n=e.user;return l.a.createElement(ee.a,null,l.a.createElement(ee.a.Avatar,{src:t.user.avatar}),l.a.createElement(ee.a.Content,{className:de(t,n)},l.a.createElement(ee.a.Author,{as:"a"},t.user.name),l.a.createElement(ee.a.Metadata,null,(a=t.timestamp,ue()(a).fromNow())),function(e){return e.hasOwnProperty("image")&&!e.hasOwnProperty("content")}(t)?l.a.createElement(q.a,{src:t.image,className:"message_image"}):l.a.createElement(ee.a.Text,null,t.content)))},he=function(e){var a=e.channel,t=e.user,r=Object(n.useState)({messages:[],messageLoading:null,messageRef:S.database().ref("messages"),listeners:[],searchTerm:""}),c=Object(N.a)(r,2),s=c[0],o=c[1],u=Object(n.useRef)(null);Object(n.useEffect)((function(){return a&&t&&(d(s.listeners),o((function(e){return Object(i.a)({},e,{messageLoading:!0})})),m(a.id)),function(){s.messageRef.off()}}),[a,t]),Object(n.useEffect)((function(){u.current.scrollIntoView({behavior:"smooth"})}));var d=function(e){e.forEach((function(e){e.ref.child(e.id).off(e.event)}))},m=function(e){h(e)},h=function(e){o((function(e){return Object(i.a)({},e,{messages:[]})}));var a=[];s.messageRef.child(e).on("child_added",(function(e){a.push(e.val()),o((function(e){return Object(i.a)({},e,{messages:a,messageLoading:!1})}))})),function(e,a,t){if(-1===s.listeners.findIndex((function(n){return n.id===e&&n.ref===a&&n.event===t}))){var n={id:e,ref:a,event:t};o((function(e){return Object(i.a)({},e,{listeners:s.listeners.concat(n)})}))}}(e,s.messageRef,"child_added")};return l.a.createElement(l.a.Fragment,null,l.a.createElement(ae,{handleChange:function(e){o(Object(i.a)({},s,Object(w.a)({},e.target.name,e.target.value)))},channelName:function(e){return e?e.name:""}(a),userAmount:function(e){var a=e.reduce((function(e,a){return e.includes(a.user.name)||e.push(a.user.name),e}),[]);return 1===a.length?"".concat(a.length," user"):"".concat(a.length," users")}(s.messages)}),l.a.createElement(F.a,{className:"messages",loading:s.messageLoading},l.a.createElement(ee.a.Group,null,function(e){if(e.length>0)return e.filter((function(e){return 0===s.searchTerm.length||void 0!==e.content&&e.content.includes(s.searchTerm)?e:null})).map((function(e){return l.a.createElement(me,{key:e.timestamp,message:e,user:t})}))}(s.messages),l.a.createElement("div",{ref:u}))),l.a.createElement(oe,{messageRef:s.messageRef,channel:a,user:t}))},fe=function(){return l.a.createElement("div",null,"MetaPanel")},pe=function(){var e=Object(o.d)((function(e){return null!==e.user.user?{user:e.user.user,channel:e.channel.channel}:{user:""}}));return l.a.createElement(M.a,{columns:"equal"},l.a.createElement(G,null),l.a.createElement($,{userData:e.user}),l.a.createElement(z.a,{style:{marginLeft:"320px"}},l.a.createElement(he,{channel:e.channel,user:e.user})),l.a.createElement(z.a,{width:4},l.a.createElement(fe,null)))},ge=t(480),Ee=t(469),be=function(){return l.a.createElement(ge.a,{active:!0},l.a.createElement(Ee.a,{size:"huge",content:"Loading"}))},ve=function(e){function a(){return Object(E.a)(this,a),Object(v.a)(this,Object(C.a)(a).apply(this,arguments))}return Object(j.a)(a,e),Object(b.a)(a,[{key:"componentDidMount",value:function(){var e=this;S.auth().onAuthStateChanged((function(a){null!==a?(e.props.setUser(a),e.props.history.push("/plackApp")):(e.props.setUser(null),e.props.history.push("/login"))}))}},{key:"render",value:function(){return this.props.isLoading?l.a.createElement(be,null):l.a.createElement("div",{className:"App"},l.a.createElement(O.c,null,l.a.createElement(O.a,{exact:!0,path:"/plackApp",component:pe}),l.a.createElement(O.a,{path:"/login",component:I}),l.a.createElement(O.a,{path:"/register",component:x})))}}]),a}(l.a.Component),Ce=Object(O.f)(Object(o.b)((function(e){return{isLoading:e.user.isLoading}}),{setUser:function(e){return{type:"SET_USER",user:e}}})(ve)),je=(t(450),t(451),Object(s.d)((function(e,a){return"RESET_APP"===a.type&&(e=void 0),m(e,a)}),Object(s.a)(h.a,p.a)));c.a.render(l.a.createElement(g.a,null,l.a.createElement(o.a,{store:je},l.a.createElement(Ce,null))),document.getElementById("root"))}},[[275,1,2]]]);
//# sourceMappingURL=main.8ccf0920.chunk.js.map